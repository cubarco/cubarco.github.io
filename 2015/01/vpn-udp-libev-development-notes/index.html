<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><title>vpn-udp-libev å¼€å‘æ€»ç»“ - /home/cubl</title><meta property="og:title" content="vpn-udp-libev å¼€å‘æ€»ç»“ - /home/cubl"><link href=https://cubl.in/favicon.ico rel=icon type=image/x-icon><meta name=description content="Network, VPN, Linux"><link rel=stylesheet href=/css/main.min.3bcbe33ae5c46485bcebc6352fc91232f950eb735ccac53f81bd19d79251ba9c.css media=all></head><body><div class=wrapper><header class=header><nav class=nav><a href=/ class=nav-logo><img src=/images/logo-min.png width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/>Index</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li><li><a href=https://github.com/cubarco/cubarco.github.io>GitHub</a></li></ul></nav></header><main class=content role=main><article class=article><h1 class=article-title>vpn-udp-libev å¼€å‘æ€»ç»“</h1><span class=article-date>2015-01-09</span>
<a class=article-tag href=/tags/network>Network</a>
<a class=article-tag href=/tags/vpn>VPN</a>
<a class=article-tag href=/tags/linux>Linux</a><div class=article-content><p>æœ€è¿‘åˆåœ¨çœ‹ UNIX ç½‘ç»œç¼–ç¨‹é‚£æœ¬ä¹¦ï¼Œå†™äº†ä¸ª vpn ç»ƒæ‰‹ï¼Œä»£ç å’Œç®€å•çš„ä»‹ç»åœ¨ <a href=https://github.com/cubarco/network-programming-exp/tree/master/vpn-udp-libev title=cubarco/network-programming-exp/vpn-udp-libev>Github</a> ä¸Š(å¥½åƒæ•ˆç‡è¿˜ä¸é”™çš„æ ·å­)ã€‚è¿™é‡Œç…§ä¾‹åšä¸€ä¸‹æ€»ç»“ï¼Œä¾¿äºä»¥åæŸ¥é˜…ã€‚</p><h2 id=å…³äºrecvfrom>å…³äº<code>recvfrom()</code></h2><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=cm>/* recvfrom() çš„å£°æ˜ */</span>
<span class=n>ssize_t</span> <span class=nf>recvfrom</span><span class=p>(</span><span class=kt>int</span> <span class=n>sockfd</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>buf</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>len</span><span class=p>,</span> <span class=kt>int</span> <span class=n>flags</span><span class=p>,</span>
                 <span class=k>struct</span> <span class=n>sockaddr</span> <span class=o>*</span><span class=n>src_addr</span><span class=p>,</span> <span class=n>socklen_t</span> <span class=o>*</span><span class=n>addrlen</span><span class=p>);</span>
</code></pre></div><p>è¿™ä¸ªå‡½æ•°æ¯”è¾ƒè¯¡å¼‚çš„æ˜¯å®ƒçš„æœ€åä¸€ä¸ªå‚æ•°<code>addrlen</code>.</p><div class=highlight><pre class=chroma><code class=language-plain data-lang=plain>If  src_addr  is  not  NULL, and the underlying protocol provides the source
address of the message, that source address is placed in the buffer  pointed
to  by  src_addr.  In this case, addrlen is a value-result argument.  Before
the call, it should be initialized to the size of the buffer associated with
src_addr.  Upon return, addrlen is updated to contain the actual size of the
source address.  The returned address is truncated if the buffer provided is
too  small;  in this case, addrlen will return a value greater than was supâ€
plied to the call.
</code></pre></div><p>ä¸€å¼€å§‹ç”¨çš„æ—¶å€™æ²¡æœ‰ä»”ç»†çœ‹ manpageï¼Œå¤©çœŸåœ°ä»¥ä¸ºæ—¢ç„¶ä¼ çš„æ˜¯æŒ‡é’ˆï¼Œå®ƒçš„ç”¨å¤„åº”è¯¥å°±åªå‚¨å­˜è¿”å›å€¼ã€‚ä½†æ˜¯æ˜¨å¤©è·Ÿ @hexchain jujuè®¨è®ºä¹‹åï¼Œå‘ç°è¿™ä¸ªå‡½æ•°è¿˜æ˜¯ä¼šç”¨åˆ°<code>addrlen</code>çš„åˆå§‹å€¼çš„,ç›®çš„å¤§æ¦‚æ˜¯ä¸ºäº†é˜²æ­¢ç»™<code>src_addr</code>ä¼ å€¼çš„æ—¶å€™æº¢å‡ºã€‚ä»¥åç”¨åº“å‡½æ•°è¿˜æ˜¯å…ˆæŸ¥æ¸…æ¥šå‚æ•°çš„å…·ä½“ç”¨å¤„å†ç”¨å§&mldr;</p><h2 id=åŒæ—¶å…¼å®¹-ipv4-å’Œ-ipv6>åŒæ—¶å…¼å®¹ IPv4 å’Œ IPV6</h2><p>æœåŠ¡å™¨ä¸ºäº†åŒæ—¶å…¼å®¹ä¸¤ç§åè®®ï¼Œä¸»è¦å°±æ˜¯ addr ç»“æ„ä½“çš„é€‰æ‹©ï¼Œ<code>sockaddr_in</code>æ˜¯ä¸º IPv4 å‡†å¤‡çš„ï¼Œåœ¨æˆ‘ x64 ç³»ç»Ÿä¸Šå®ƒçš„ç»“æ„ä½“å¤§å°æ˜¯ 16Bï¼Œè€Œ<code>sockaddr_in6</code>æ˜¯ä¸º IPv6 å‡†å¤‡çš„ï¼Œå¤§å°æ˜¯28Bï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸º<code>sockaddr</code>æ˜¯å…¼å®¹äºŒè€…çš„ç»“æ„ä½“ï¼Œä½†æ˜¯è¿™è´§å¤§å°åªæœ‰16Bã€‚åœ¨<a href=https://github.com/clowwindy/ShadowVPN title=ShadowVPN>ShadowVPN</a>ä»£ç é‡Œæ‰¾äº†æ‰¾ï¼Œå‘ç°<code>sockaddr_storage</code>è¿™ä¸ªç»“æ„ä½“ï¼Œæ®è¯´æ˜¯å…¼å®¹äº†æ‰€æœ‰ addr ç»“æ„ï¼ŒåŒ…æ‹¬æœ€å¤§çš„ UNIX å¥—æ¥å­—ï¼Œå¤§å°æœ‰ 128Bã€‚ç„¶åå…·ä½“åˆ° IP åœ°å€çš„è½¬æ¢ï¼Œå¯ä»¥ç”¨<code>inet_pton()</code>è¿™ä¸ªå…¼å®¹ä¸¤ç§IPåè®®çš„å‡½æ•°ã€‚</p><h2 id=å…³äº-mtu>å…³äº MTU</h2><p>ä¹‹å‰å¯¹ MTU ä¸€ç›´æ˜¯äº‘é‡Œé›¾é‡Œçš„ï¼Œè¿™æ¬¡ç®—æ˜¯å¯¹å®ƒæœ‰äº†ä¸€ç‚¹äº†è§£ã€‚<a href=http://en.wikipedia.org/wiki/Maximum_transmission_unit>MTU(Maximum transmission unit)</a>æŒ‡çš„å°±æ˜¯é€šè®¯åè®®çš„<code>DATA</code>å—çš„æœ€å¤§å®¹é‡ã€‚ä¸€ä¸ª link çš„ MTU å†³å®šäº†é€šè¿‡å®ƒçš„ IP åŒ…çš„æœ€å¤§ä½“ç§¯ã€‚æ‰€ä»¥è®¾ç½®ä¸€ä¸ª tunnel è®¾å¤‡çš„ MTU å¯ä»¥ç¡®ä¿è¿™äº› IP åŒ…åœ¨å¥—ä¸Šå¦ä¸€å±‚ UDP + IP çš„ header ä¹‹åä¸ä¼šè¢«è¶…å‡º MTU è¢« fragment.</p><h2 id=å…³äºå‹ç¼©>å…³äºå‹ç¼©</h2><p>æœ€å¤§(æ— æŸ)å‹ç¼©æ¯”ä¾‹å†³å®šäºä¿¡æ¯ç†µã€‚æ‰€ä»¥ç”¨<code>dd if=/dev/urandom bs=1M count=100 | gzip - | wc -c</code>è¿™ç§æ–¹å¼æµ‹è¯•å‹ç¼©æ¯”ä¾‹çš„ç»“æœå¾€å¾€æ˜¯å‹ç¼©æ¯”ä¾‹å¤§äº1&mldr;</p><h2 id=more>More</h2><p>æƒ³åˆ°å†å†™</p></div></article><script src=https://utteranc.es/client.js repo=cubarco/cubarco.github.io issue-term=pathname label="Comments ğŸ’¬" theme=boxy-light crossorigin=anonymous async defer></script></main><footer class=footer><ul class=footer-links><li><a href=/index.xml type=application/rss+xml target=_blank>RSS feed</a></li><li><a href=https://gohugo.io/ class=footer-links-kudos target=_blank rel="noopener norefferrer">Made with <img src=/images/hugo-logo.png alt="Img link to Hugo website" width=22 height=22></a></li><li><a>Â© 2014 - 2015</a></li></ul></footer></div><script async src=https://cdn.jsdelivr.net/gh/cubarco/cubarco.github.io@gh-pages/js/async.min.9dcd5af2314ea1bd2436e3e38f6726aed4ce5fc788ec63ab8aa8f43650deb466ff56cf92e98559a2e77d08fead5bf4f3e47073c87c7fd92f2c963ee54133358c.js onload=window.GistEmbed.init()></script><script async defer src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js></script><script>window.ga_tid="UA-54867602-1",window.ga_api="https://cubl.in/ga-proxy/"</script><script src=https://cdn.jsdelivr.net/npm/cfga@1.0.3 async defer></script><script async defer data-website-id=e9fdcc32-0bfa-4de5-beb0-3bbf1e4638ab src=https://umami.pwn.ooo/umami.js></script></body></html>