<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><title>è§£å†³ç”¨ ldconfig æŒ‡å®š libgl åº“æ—¶ Steam çš„å¼‚å¸¸ - /home/cubl</title><meta property="og:title" content="è§£å†³ç”¨ ldconfig æŒ‡å®š libgl åº“æ—¶ Steam çš„å¼‚å¸¸ - /home/cubl"><link href=https://cubl.in/favicon.ico rel=icon type=image/x-icon><meta name=description content="Pwning for fun."><link rel=stylesheet href=/css/main.min.39d87073ffff84c35a9b5d21e8b94ef0643a51af7a909c6f3d506433db4442a1.css media=all></head><body><div class=wrapper><header class=header><nav class=nav><a href=/ class=nav-logo><img src=/images/logo-min.png width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/>Index</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li><li><a href=https://github.com/cubarco/cubarco.github.io>GitHub</a></li></ul></nav></header><main class=content role=main><article class=article><h1 class=article-title>è§£å†³ç”¨ ldconfig æŒ‡å®š libgl åº“æ—¶ Steam çš„å¼‚å¸¸</h1><span class=article-date>2015-01-28</span>
<a class=article-tag href=/tags/linux>Linux</a>
<a class=article-tag href=/tags/ldconfig>ldconfig</a>
<a class=article-tag href=/tags/steam>Steam</a>
<a class=article-tag href=/tags/graphics-card>Graphics Card</a><div class=article-content><p>åˆšè€ƒå®Œè¯•ï¼Œæœ‰ç‚¹æ— èŠï¼Œå¼€ Steam å‡†å¤‡ç©ç‚¹æ¸¸æˆï¼Œç»“æœå‘ç°ä¹‹å‰çš„ä¸€ä¸ªè„šæœ¬ä¸èƒ½ç”¨äº†ã€‚æˆ‘çš„æœºå™¨çš„æƒ…å†µæ˜¯ Intel é›†æ˜¾ + NVIDIA ç‹¬æ˜¾ã€‚ä¸¤ä¸ªæ˜¾å¡çš„åˆ‡æ¢ä¸€ç›´æ˜¯ä»¶å¾ˆè›‹ç–¼çš„äº‹æƒ…ï¼Œoptirunä»€ä¹ˆçš„æ€§èƒ½å®åœ¨å¤ªå·®ï¼Œå¦‚æœä¸€ç›´ç‹¬æ˜¾ç›´å‡ºï¼Œè€—ç”µä¹Ÿæ˜¯ä¸ªå¤§é—®é¢˜ã€‚è¿™ä¸ªå­¦æœŸåˆå’Œ @hyrathb juju ä¸€èµ·ç ”ç©¶äº†ä¸€ä¸‹ï¼Œç”¨ ldconfig å°½å¯èƒ½å‡å°‘åˆ‡æ¢æ˜¾å¡å¸¦æ¥çš„éº»çƒ¦(å°±æ˜¯å…ˆå…³X, ç„¶åè·‘ä¸ªè„šæœ¬å¼€ç‹¬æ˜¾ç›´å‡ºçš„X, å¦‚æœéœ€è¦è¿™ä¸ªè§£å†³æ–¹æ¡ˆæˆ‘å¯ä»¥å•ç‹¬poæ–‡).</p><h2 id=steam-çš„å‘>Steam çš„å‘</h2><p>Steam ä¸ºäº†<code>Need to add /usr/lib32 to the library path to pick up libvdpau_nvidia.so on Ubuntu 12.04</code>æŠŠ<code>/usr/lib32</code>åŠ è¿›äº†<code>LD_LIBRARY_PATH</code>å˜é‡ï¼Œç»“æœè™½ç„¶åœ¨ ldconfig ä¸­æœ¬æ¥æ˜¯ NVIDIA çš„ libgl åº“ä¼˜å…ˆï¼Œä½†æ˜¯<code>/usr/lib32</code>é‡Œé¢é»˜è®¤ mesa çš„ libgl åº“çš„é“¾æ¥å´è¢«ä¼˜å…ˆåŠ è½½äº†ã€‚å¯¼è‡´ Steam å¯åŠ¨æ—¶ä¼šæŠ¥<code>Not direct rendering</code>ä¹‹ç±»çš„é”™è¯¯ã€‚</p><h2 id=ä¹‹å‰çš„è§£å†³åŠæ³•>ä¹‹å‰çš„è§£å†³åŠæ³•</h2><p>è¿™ä¸ªå­¦æœŸåˆæ˜¯é¡ºä¾¿è§£å†³äº†è¿™ä¸ªé—®é¢˜çš„ï¼Œå½“æ—¶å°±æ˜¯æŠŠ steam.sh é‡Œé¢å¦‚ä¸‹è¿™è¡Œæ³¨é‡Šæ‰ã€‚</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=nb>export</span> <span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$LD_LIBRARY_PATH</span><span class=s2>:/usr/lib32&#34;</span>
</code></pre></div><p>ä½†æ˜¯ Steam ä¼šåœ¨å¯åŠ¨æ—¶æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ï¼Œç¬¬ä¸€æ¬¡æ£€æŸ¥æ˜¯æ£€æŸ¥å¤§å°ï¼Œæ‰€ä»¥æŠŠæ–‡ä»¶åˆ æ‰ä¸€ä¸ªå­—èŠ‚å°±å¥½äº†ã€‚ä¸è¿‡è¦åœ¨å¯åŠ¨ Steam åæ¢å›åŸæ–‡ä»¶ï¼Œå› ä¸º Steam ä¼šç¬¬äºŒæ¬¡æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ï¼Œè¿™æ¬¡å¤§æ¦‚æ˜¯æ£€æŸ¥å“ˆå¸Œå€¼ã€‚æˆ‘æ˜¯å†™äº†ä¸ªè„šæœ¬ï¼Œå‡†å¤‡ä¸¤ä¸ªæ–‡ä»¶ï¼ŒåŸæ–‡ä»¶å’Œä¿®æ”¹åçš„æ–‡ä»¶ï¼Œcp ä¸¤æ¬¡ã€‚ä¸è¿‡æœ€è¿‘å‡çº§åï¼Œç¬¬ä¸€æ¬¡æ£€æŸ¥çš„å¥½åƒä¹Ÿæ˜¯å“ˆå¸Œå€¼äº†ã€‚æ£€æŸ¥çš„é‚£äº›æ­¥éª¤ä¼°è®¡éƒ½æ˜¯å†™è¿›äºŒè¿›åˆ¶çš„ï¼Œæƒ³ç»•è¿‡ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œè¿™è„šæœ¬å°±æ²¡æ•‘äº†ã€‚</p><h2 id=æ–°å‘ç°>æ–°å‘ç°</h2><p>è¿™æ¬¡ä»”ç»†è¯»äº†ä¸€ä¸‹ steam.sh, è¿™ä¸€å—ä»£ç è¿˜æ˜¯å¯ä»¥å¥½å¥½åˆ©ç”¨ä¸€ä¸‹çš„:</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1># and launch steam</span>
<span class=nv>STEAM_DEBUGGER</span><span class=o>=</span><span class=nv>$DEBUGGER</span>
<span class=nb>unset</span> DEBUGGER <span class=c1># Don&#39;t use debugger if Steam launches itself recursively</span>
<span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$STEAM_DEBUGGER</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;gdb&#34;</span> <span class=o>]</span> <span class=o>||</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$STEAM_DEBUGGER</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;cgdb&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>


    <span class=c1># Set the LD_PRELOAD varname in the debugger, and unset the global version.</span>
    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$LD_PRELOAD</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=nb>set</span> env <span class=nv>LD_PRELOAD</span><span class=o>=</span><span class=nv>$LD_PRELOAD</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$ARGSFILE</span><span class=s2>&#34;</span>
        <span class=nb>echo</span> show env LD_PRELOAD &gt;&gt; <span class=s2>&#34;</span><span class=nv>$ARGSFILE</span><span class=s2>&#34;</span>
        <span class=nb>unset</span> LD_PRELOAD
    <span class=k>fi</span>

    <span class=nv>$STEAM_DEBUGGER</span> -x <span class=s2>&#34;</span><span class=nv>$ARGSFILE</span><span class=s2>&#34;</span> --args <span class=s2>&#34;</span><span class=nv>$STEAMROOT</span><span class=s2>/</span><span class=nv>$STEAMEXEPATH</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
    rm <span class=s2>&#34;</span><span class=nv>$ARGSFILE</span><span class=s2>&#34;</span>
<span class=k>elif</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$STEAM_DEBUGGER</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;valgrind&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
    <span class=nv>DONT_BREAK_ON_ASSERT</span><span class=o>=</span><span class=m>1</span> <span class=nv>G_SLICE</span><span class=o>=</span>always-malloc <span class=nv>G_DEBUG</span><span class=o>=</span>gc-friendly valgrind --error-limit<span class=o>=</span>no --undef-value-errors<span class=o>=</span>no --suppressions<span class=o>=</span><span class=nv>$PLATFORM</span>/steam.supp <span class=nv>$STEAM_VALGRIND</span> <span class=s2>&#34;</span><span class=nv>$STEAMROOT</span><span class=s2>/</span><span class=nv>$STEAMEXEPATH</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span> 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=p>|</span> tee steam_valgrind.txt
<span class=k>elif</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$STEAM_DEBUGGER</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;callgrind&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
    valgrind --tool<span class=o>=</span>callgrind --instr-atstart<span class=o>=</span>no <span class=s2>&#34;</span><span class=nv>$STEAMROOT</span><span class=s2>/</span><span class=nv>$STEAMEXEPATH</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
<span class=k>elif</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$STEAM_DEBUGGER</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;strace&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
    strace -osteam.strace <span class=s2>&#34;</span><span class=nv>$STEAMROOT</span><span class=s2>/</span><span class=nv>$STEAMEXEPATH</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
<span class=k>else</span>
    <span class=nv>$STEAM_DEBUGGER</span> <span class=s2>&#34;</span><span class=nv>$STEAMROOT</span><span class=s2>/</span><span class=nv>$STEAMEXEPATH</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
<span class=k>fi</span>
</code></pre></div><p>åªè¦<code>DEBUGGER</code>ç¯å¢ƒå˜é‡ä¸åŒ¹é…ç»™å®šçš„å­—ç¬¦ä¸²ï¼Œæœ€å Steam å°±ä¼šä»¥ä¸‹è¿°æ–¹å¼æ‰§è¡Œ:</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=nv>$STEAM_DEBUGGER</span> <span class=s2>&#34;</span><span class=nv>$STEAMROOT</span><span class=s2>/</span><span class=nv>$STEAMEXEPATH</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</code></pre></div><h2 id=æ–°çš„è§£å†³åŠæ³•>æ–°çš„è§£å†³åŠæ³•</h2><p>éšä¾¿åˆ›å»ºä¸ªæ–‡ä»¶ï¼Œåªè¦åå­—ä¸æ˜¯gdb, cgdb, valgrind, strace. å†…å®¹æ˜¯:</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=cp>#!/bin/bash
</span><span class=cp></span>
<span class=nb>export</span> <span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span> <span class=nv>$LD_LIBRARY_PATH</span> <span class=p>|</span> sed <span class=s2>&#34;s/:\/usr\/lib32//&#34;</span><span class=sb>`</span>
<span class=nb>exec</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</code></pre></div><p>ç»™æ‰§è¡Œæƒé™ã€‚</p><p>ç„¶åè¿™æ ·å¯åŠ¨ Steam å°±è¡Œäº†ã€‚</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1># For example: env DEBUGGER=/usr/bin/STEAM_DEBUGGER steam</span>
env <span class=nv>DEBUGGER</span><span class=o>=</span>/path/to/script steam
</code></pre></div></div></article><script src=https://utteranc.es/client.js repo=cubarco/cubarco.github.io issue-term=pathname label="Comments ğŸ’¬" theme=boxy-light crossorigin=anonymous async></script></main><footer class=footer><ul class=footer-links><li><a href=/index.xml type=application/rss+xml target=_blank>RSS feed</a></li><li><a href=https://gohugo.io/ class=footer-links-kudos target=_blank rel="noopener norefferrer">Made with <img src=/images/hugo-logo.png alt="Img link to Hugo website" width=22 height=22></a></li><li><a>Â© 2014 - 2015</a></li></ul></footer></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js async></script><script src=https://cdn.jsdelivr.net/gh/cubarco/cubarco.github.io@gh-pages/js/main.min.60d77477267181e7581bba5435ded18ab8ff1db3955dde2d3afeec25cc51d24e32b178b6c1ebb5edc2a4cef04c8f592408eb2811f0c78c9295b8a0939977a6a1.js async></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-54867602-1','auto'),ga('send','pageview'))</script><script async defer data-website-id=e9fdcc32-0bfa-4de5-beb0-3bbf1e4638ab src=https://umami.pwn.ooo/umami.js></script><script async defer src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js></script></body></html>