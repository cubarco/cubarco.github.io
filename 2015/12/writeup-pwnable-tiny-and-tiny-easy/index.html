<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><title>Writeup-Pwnable: tiny & tiny_easy - /home/cubarco</title><meta property="og:title" content="Writeup-Pwnable: tiny & tiny_easy - /home/cubarco"><link href=https://cubar.co/favicon.ico rel=icon type=image/x-icon><meta name=description content="Hack, CTF, Writeup, Exploitation, ROP"><link rel=stylesheet href=/css/main.min.3bcbe33ae5c46485bcebc6352fc91232f950eb735ccac53f81bd19d79251ba9c.css media=all></head><body><div class=wrapper><header class=header><nav class=nav><a href=/ class=nav-logo><img src=/images/logo-min.png width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/>Index</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li><li><a href=/links/>Links</a></li><li><a href=https://github.com/cubarco/cubarco.github.io>GitHub</a></li></ul></nav></header><main class=content role=main><article class=article><h1 class=article-title>Writeup-Pwnable: tiny & tiny_easy</h1><span class=article-date>2015-12-11</span>
<a class=article-tag href=/tags/hack>Hack</a>
<a class=article-tag href=/tags/ctf>CTF</a>
<a class=article-tag href=/tags/writeup>Writeup</a>
<a class=article-tag href=/tags/exploitation>Exploitation</a>
<a class=article-tag href=/tags/rop>ROP</a><div class=article-content><h2 id=tiny_easy>tiny_easy</h2><h3 id=1-brute-force>1. Brute force</h3><p>è¿™é¢˜çš„ bin æ‹¿åˆ°ä¹‹åå¼€ gdb çœ‹äº†ä¸€ä¸‹ mapping, å‘ç° stack æ˜¯å¯æ‰§è¡Œçš„(å¦‚æœ ELF æ²¡æœ‰ GNU_STACK è¿™ä¸ª header, åˆ™é»˜è®¤ stack å¯æ‰§è¡Œ<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>)ã€‚æ‰€ä»¥æ€è·¯å¾ˆæ˜æ˜¾äº†ã€‚</p><p>çœ‹ä¸€ä¸‹åæ±‡ç¼–:</p><div class=highlight><pre class=chroma><code class=language-plain data-lang=plain>8048054:	58             pop %eax
8048055:	5a             pop %edx
8048056:	8b12           mov (%edx),%edx
8048058:	ffd2           call *%edx
</code></pre></div><p>ç„¶åç”¨ gdb æ–­åœ¨ entry point, è§‚å¯Ÿä¸€ä¸‹æ ˆ:</p><div class=highlight><pre class=chroma><code class=language-plain data-lang=plain>$ gdb tiny_easy
(gdb) b *0x8048054
Breakpoint 1 at 0x8048054
(gdb) r
Starting program: /home/tiny_easy/tiny_easy

Breakpoint 1, 0x08048054 in ?? ()
(gdb) x/32wx $esp
0xffd82d70: 0x00000001  0xffd84df5  0x00000000  0xffd84e0f
0xffd82d80: 0xffd84e1f  0xffd84e33  0xffd84e54  0xffd84e68
0xffd82d90: 0xffd84e77  0xffd84e83  0xffd84ed0  0xffd84ee9
0xffd82da0: 0xffd84ef8  0xffd84f0c  0xffd84f1d  0xffd84f63
0xffd82db0: 0xffd84f6c  0xffd84f81  0xffd84f89  0xffd84f99
0xffd82dc0: 0xffd84fab  0x00000000  0x00000020  0xf776bb50
0xffd82dd0: 0x00000021  0xf776b000  0x00000010  0x0fabfbff
0xffd82de0: 0x00000006  0x00001000  0x00000011  0x00000064
</code></pre></div><p>å‘ç° $esp ä½ç½®æ˜¯å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°(å³ argc)ï¼Œåé¢å€Ÿç€çš„éƒ½æ˜¯ argv[i], ä»¥ NULL ç»“å°¾ï¼Œå†ä¹‹åéƒ½æ˜¯ç¯å¢ƒå˜é‡(å³ envp)ã€‚</p><p>è§‚å¯Ÿåˆ°è¿™é‡Œï¼Œè¿™é¢˜å°±æœ‰äº†ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„è§£æ³•ï¼Œå³åœ¨ argv[0] é‡Œé¢æ”¾çŒœæµ‹çš„æ ˆä¸­çš„æŸä¸ªåœ°å€ï¼Œç„¶åè·³åˆ°å­˜åœ¨ argv[1&mldr;n] é‡Œé¢çš„ shellcode. ä½†æ˜¯ç”±äº ASLR, éœ€è¦ç”¨å¾ˆå¤š nop æ¥å¡«å…… stack, æ¥å¢åŠ  bruteforce çš„å‘½ä¸­ç‡ã€‚</p><h4 id=exptiny_easyc>exp.tiny_easy.c</h4><code class=gist data-gist-id=cubarco/03fb090852a3303f58db data-gist-file=pwnable-rookiss-tiny-easy.c><p>Gist: <a href=https://gist.github.com/cubarco/03fb090852a3303f58db>cubarco/03fb090852a3303f58db</a></p></code><h3 id=2-vdso2>2. vDSO<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></h3><p>è¿™ä¸ªæ€è·¯æ˜¯åœ¨åš tiny çš„æ—¶å€™å¾—æ¥çš„ã€‚ç®€å•æ¥è¯´å°±æ˜¯åˆ©ç”¨ vdso é‡Œé¢çš„ gadgets å‡†ç¡®çš„è·³åˆ° shellcodeã€‚è™½ç„¶ ASLR ä¼šå¯¼è‡´ vdso çš„åŠ è½½ä½ç½®éšæœºï¼Œä½†æ˜¯åœ¨ shell ä¸­æ‰§è¡Œ<code>ulimit -s unlimited</code>å¯ä»¥å…³æ‰éšæœº mmap<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p><p><em>vdso å¯ä»¥åœ¨ gdb è°ƒè¯•çš„æ—¶å€™ç”¨ dump<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> å‘½ä»¤å¯¼å‡ºã€‚</em></p><h4 id=exptiny_easypy>exp.tiny_easy.py</h4><code class=gist data-gist-id=cubarco/03fb090852a3303f58db data-gist-file=pwnable-rookiss-tiny-easy.py><p>Gist: <a href=https://gist.github.com/cubarco/03fb090852a3303f58db>cubarco/03fb090852a3303f58db</a></p></code><h2 id=tiny>tiny</h2><p>è¿™é¢˜å°±æ˜¯ tiny_easy å¼€ NX çš„ç‰ˆæœ¬ï¼Œåªå¥½ ROP. èƒ½ç”¨çš„ gadgets åªæœ‰ vdso å’Œ text æ®µ 6 ä¸ªå­—èŠ‚çš„æŒ‡ä»¤(å“­).</p><p>å…·ä½“æ€ä¹ˆæ„é€  ROP, ç»å°½è„‘æ±æƒ³äº†å¾ˆä¹…ã€‚ç›®çš„å°±æ˜¯ä¸€ä¸ª: <code>execv("/bin/sh")</code>ï¼Œè€Œæ‰§è¡Œè¿™ä¸ªç³»ç»Ÿè°ƒç”¨éœ€è¦å°† eax è®¾ç½®ä¸º 0xbï¼Œebx è®¾ç½®ä¸ºå­—ç¬¦ä¸²æŒ‡é’ˆã€‚å‰è€…å¾ˆå®¹æ˜“å®ç°ï¼Œåªè¦æ§åˆ¶ argc ä¸º 11 å°±å¯ä»¥ï¼Œéº»çƒ¦çš„æ˜¯ ebx.</p><p>ä¸€å¼€å§‹æƒ³æ€ä¹ˆæ”¹ ebp å’Œ esp çš„å€¼ï¼Œè®© ret æŒ‡ä»¤è¿”å›åœ°å€èƒ½å—æˆ‘çš„æ§åˆ¶ï¼Œä¹‹åæ–¹ä¾¿æ„é€  ROP chain. åœ¨è‰ç¨¿çº¸ä¸Šå†™å†™ç”»ç”»è¯•äº†å¾ˆä¹…æ²¡æœ‰æˆåŠŸï¼Œé‚æ”¾å¼ƒã€‚ä¹‹åæ´—äº†ä¸ªæ¾¡ï¼Œå›æ¥é‡æ–°çœ‹ stack é‡Œé¢çš„å†…å®¹ï¼Œæœ‰äº†å¾ˆé‡è¦çš„æ”¶è·ã€‚</p><div class=highlight><pre class=chroma><code class=language-plain data-lang=plain>(gdb) x/32wx $esp
...
0xffd82dc0: 0xffd84fab  0x00000000  0x00000020  0xf776bb50
0xffd82dd0: 0x00000021  0xf776b000  0x00000010  0x0fabfbff
...
</code></pre></div><p>æˆªå–äº†ä¸Šæ–‡ä¸­çš„ä¸€éƒ¨åˆ† stack æ•°æ®ï¼Œå¯ä»¥å‘ç°åœ¨ 0xffd82dec çš„ä½ç½®æœ‰ä¸ª 0xf776bb50, çœ‹äº†ä¸€ä¸‹ï¼Œæ˜¯ vdso ä¸­<code>__kernel_vsyscall</code>çš„èµ·å§‹ä½ç½®ï¼Œå¦‚æœå¯ä»¥ ret åˆ°è¿™é‡Œï¼Œå°±èƒ½è°ƒç”¨ç³»ç»Ÿè°ƒç”¨äº†ã€‚</p><p>ç„¶åå¼€å§‹æ‰¾ gadgets.</p><div class=highlight><pre class=chroma><code class=language-plain data-lang=plain>5c8:	83 c4 3c             	add    $0x3c,%esp
5cb:	5b                   	pop    %ebx
5cc:	5e                   	pop    %esi
5cd:	5f                   	pop    %edi
5ce:	5d                   	pop    %ebp
5cf:	c3                   	ret
</code></pre></div><p>GOTCHA!!! è¿™é‡Œå°†æ ˆæŒ‡é’ˆå¢åŠ äº† 0x3c, ç„¶å<code>pop %ebx</code>é¡ºä¾¿æ»¡è¶³äº† execv ç³»ç»Ÿè°ƒç”¨çš„ç¬¬äºŒä¸ªè¦æ±‚ã€‚ä»”ç»†è§‚å¯Ÿäº†æ ˆçš„å†…å®¹ï¼Œåªè¦ä¿è¯æœ‰ 11 ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œ5 ä¸ªç¯å¢ƒå˜é‡å°±èƒ½å®Œæˆ execv çš„è°ƒç”¨ï¼Œå…¶ä¸­ç¬¬å››ä¸ªç¯å¢ƒå˜é‡çš„å­—ç¬¦ä¸²æ˜¯æ‰§è¡Œè·¯å¾„ã€‚</p><h4 id=exptinysh>exp.tiny.sh</h4><p>è¿™ä¸ª exp çš„æ ¸å¿ƒæ˜¯ C (å…¶å®å°±æ˜¯ä¸€å¥<code>execle()</code>çš„äº‹æƒ…), ç”¨ shell å†™åªæ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œå¯ä»¥æŠŠ<code>ulimit -s unlimited</code>è¿™äº›å‘½ä»¤æ”¾åœ¨ä¸€èµ·(è°ƒè¯•è¿‡ç¨‹ä¸­è¿˜ç”¨åˆ°äº†å…¶ä»–å‘½ä»¤ï¼Œæœ€ååˆ çš„åªå‰© ulimit&mldr;)ï¼Œè€Œä¸”ç”¨ä¸€ä¸ªè„šæœ¬è§£é¢˜æœ¬èº«æ˜¯ä¸€ä»¶å¾ˆé…·çš„äº‹æƒ…XD.</p><code class=gist data-gist-id=cubarco/d379e31c9487c8ee07f2 data-gist-file=pwnable-hackerssecret-tiny.sh><p>Gist: <a href=https://gist.github.com/cubarco/d379e31c9487c8ee07f2>cubarco/d379e31c9487c8ee07f2</a></p></code><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a href=https://wiki.gentoo.org/wiki/Hardened/GNU_stack_quickstart#Causes_of_executable_stack_markings>Causes of executable stack markings</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p><a href=https://en.wikipedia.org/wiki/VDSO>vDSO</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p><a href=http://security.cs.pub.ro/hexcellents/wiki/kb/exploiting/home#address-space-layout-randomization>Address space layout randomization</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p><a href=https://sourceware.org/gdb/onlinedocs/gdb/Dump_002fRestore-Files.html>Debugging with GDB#Copy Between Memory and a File</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></article><script src=https://utteranc.es/client.js repo=cubarco/cubarco.github.io issue-term=pathname label="Comments ğŸ’¬" theme=boxy-light crossorigin=anonymous async defer></script></main><footer class=footer><ul class=footer-links><li><a href=/index.xml type=application/rss+xml target=_blank>RSS feed</a></li><li><a href=https://gohugo.io/ class=footer-links-kudos target=_blank rel="noopener norefferrer">Made with <img src=/images/hugo-logo.png alt="Img link to Hugo website" width=22 height=22></a></li><li><a>Â© 2014 - 2021</a></li></ul></footer></div><script async src=https://cdn.jsdelivr.net/gh/cubarco/cubarco.github.io@gh-pages/js/async.min.e8b856a43b93a78048deb0cb92ad99794ad3acb0a2c8093599a653ece0f0a17be8763cdfc99be237c1100cf84542be5aeebc0a7cac0935c48e7b3c95b87c6f34.js onload=window.GistEmbed.init()></script><script async defer src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js></script><script>window.ga_tid="UA-54867602-1",window.ga_api="https://cubar.co/ga-proxy/"</script><script src=https://cdn.jsdelivr.net/npm/cfga@1.0.3 async defer></script><script async defer data-website-id=e9fdcc32-0bfa-4de5-beb0-3bbf1e4638ab src=https://umami.2oo.in/umami.js></script></body></html>