<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><title>Writeup: 32c3ctf - /home/cubl</title><meta property="og:title" content="Writeup: 32c3ctf - /home/cubl"><link href=/favicon.ico rel=icon type=image/x-icon><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/cubarco/cubarco.github.io@gh-pages/css/main.min.9861353c7baacf2268a74fe7ea9d3bd8211eada1554a630c4d29fb448bfae5fb8f43ea02baa52d2ca079d0027f37aa8f058ab0362f4301e9a9b77538d71b549b.css media=all></head><body><div class=wrapper><header class=header><nav class=nav><a href=/ class=nav-logo><img src=/images/logo-min.png width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li><li><a href=https://github.com/cubarco/cubarco.github.io>GitHub</a></li></ul></nav></header><main class=content role=main><article class=article><h1 class=article-title>Writeup: 32c3ctf</h1><span class=article-date>2015-12-30</span>
<a class=article-tag href=/tags/hack>Hack</a>
<a class=article-tag href=/tags/ctf>CTF</a>
<a class=article-tag href=/tags/writeup>Writeup</a>
<a class=article-tag href=/tags/exploitation>Exploitation</a>
<a class=article-tag href=/tags/pwn>PWN</a>
<a class=article-tag href=/tags/misc>MISC</a><div class=article-content><h2 id=forth>forth</h2><p>forth 直接能跑system<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>。</p><div class=highlight><pre class=chroma><code class=language-plain data-lang=plain>S&#34; sh&#34; system
</code></pre></div><h2 id=gurke>gurke</h2><p>pickle 在 unpickle 的时候会执行对象的 <code>__reduce__</code> 方法<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>。用 eval 把 <code>__main__.flag.flag</code> 打进 stderr 就行了。</p><div class=gist data-gist=cubarco/e46eb03e1cd06046d130><p>Gist: <a href=https://gist.github.com/cubarco/e46eb03e1cd06046d130>cubarco/e46eb03e1cd06046d130</a></p></div><h2 id=teufel>teufel</h2><p>这题的 bin 不大，里面的 gadgets 很少，但是给了 libc. 思路就是先 leak 出保存在栈中的 rbp, 然后 offset 到 system。</p><p>这个 offset 要先在本机确定后三位(16 进制), 然后跑个脚本，用 0x1000 的步长去爆破服务器上的 offset. 我的办法是先找<code>__stack_chk_fail</code>, 原因是这个函数不需要参数就能输出。</p><h3 id=offsetpy>offset.py</h3><div class=gist data-gist=cubarco/569fd814a29d8ef988e1 data-gist-file=32c3ctf-teufel-offset.py><p>Gist: <a href=https://gist.github.com/cubarco/569fd814a29d8ef988e1>cubarco/569fd814a29d8ef988e1</a></p></div><h3 id=exppy>exp.py</h3><div class=gist data-gist=cubarco/569fd814a29d8ef988e1 data-gist-file=32c3ctf-teufel-exp.py><p>Gist: <a href=https://gist.github.com/cubarco/569fd814a29d8ef988e1>cubarco/569fd814a29d8ef988e1</a></p></div><h2 id=吐槽><del>吐槽</del></h2><p>~~readme 的 flag 居然是文件名&mldr; ~~不过<code>LIBC_FATAL_STDERR_</code>这个环境变量确实是以前没见过的。</p><p><strong>update 2016-01-24:</strong> 关于 readme 这道题，之前以为 flag 是文件名，做 ZCTF 的 guess 时<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>，回来看才发现原来是把<code>argv[1]</code>改掉了，蛮有意思。</p><p>@rickyz 的 sandbox 解法<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>蛮有意思，居然想到争抢修改系统调用参数。直接改<code>/proc/self/mem</code>来改变程序流也是第一次见。</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a href=http://rosettacode.org/wiki/Execute_a_system_command#Forth>Execute a system command#forth</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p><a href=https://docs.python.org/2/library/pickle.html#object.__reduce__>Pickling and unpickling extension types</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p><a href=https://cubl.in/blog/2016/01/writeup-zctf/>Writeup: ZCTF</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p><a href=https://rzhou.org/~ricky/32c3/sandbox/>Index of /~ricky/32c3/sandbox/</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></article><script src=https://utteranc.es/client.js repo=cubarco/cubarco.github.io issue-term=pathname theme=boxy-light crossorigin=anonymous async></script></main><footer class=footer><ul class=footer-links><li><a href=/index.xml type=application/rss+xml target=_blank>RSS feed</a></li><li><a href=https://gohugo.io/ class=footer-links-kudos target=_blank rel="noopener norefferrer">Made with <img src=/images/hugo-logo.png alt="Img link to Hugo website" width=22 height=22></a></li><li><a>© 2014 - 2015</a></li></ul></footer></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js async></script><script src=https://cdn.jsdelivr.net/gh/cubarco/cubarco.github.io@gh-pages/js/main.min.60d77477267181e7581bba5435ded18ab8ff1db3955dde2d3afeec25cc51d24e32b178b6c1ebb5edc2a4cef04c8f592408eb2811f0c78c9295b8a0939977a6a1.js async></script></body></html>