<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Steam on /home/cubl</title><link>/tags/steam/</link><description>Recent content in Steam on /home/cubl</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 14 May 2015 00:00:00 +0000</lastBuildDate><atom:link href="/tags/steam/index.xml" rel="self" type="application/rss+xml"/><item><title>一个解决 Linux 版 Dota 2 中 CJK 字符显示成方块的 Workaround</title><link>/2015/05/%E4%B8%80%E4%B8%AA%E8%A7%A3%E5%86%B3-linux-%E7%89%88-dota-2-%E4%B8%AD-cjk-%E5%AD%97%E7%AC%A6%E6%98%BE%E7%A4%BA%E6%88%90%E6%96%B9%E5%9D%97%E7%9A%84-workaround/</link><pubDate>Thu, 14 May 2015 00:00:00 +0000</pubDate><guid>/2015/05/%E4%B8%80%E4%B8%AA%E8%A7%A3%E5%86%B3-linux-%E7%89%88-dota-2-%E4%B8%AD-cjk-%E5%AD%97%E7%AC%A6%E6%98%BE%E7%A4%BA%E6%88%90%E6%96%B9%E5%9D%97%E7%9A%84-workaround/</guid><description>不知道从什么时候开始，Linux 版本的 Dota 2 中载入界面的 tips sentences 和 player name 中的中文会显示成方框，详见 issue-1688。V社基本没搭理这个 bug，只好自己动手修。
猜想是游戏内直接使用了某个字体，或者该字体不存在时调用了默认字体，但是他们不支持 CJK 字符，所以显示成方块。因为 SteamFonts 给的全是Arial字体，我猜 Dota 2 那些文本使用的字体可能是Arial，开FC_DEBUG跑了一遍发现猜的没错。那么我们要做的就是用fontconfig把Arial替换成支持中文的字体。
解决办法 替换Arial的fontconfig配置是:
1 2 3 4 5 6 7 8 &amp;lt;match target=&amp;#34;pattern&amp;#34;&amp;gt; &amp;lt;test qual=&amp;#34;any&amp;#34; name=&amp;#34;family&amp;#34;&amp;gt; &amp;lt;string&amp;gt;Arial&amp;lt;/string&amp;gt; &amp;lt;/test&amp;gt; &amp;lt;edit name=&amp;#34;family&amp;#34; mode=&amp;#34;assign&amp;#34; binding=&amp;#34;same&amp;#34;&amp;gt; &amp;lt;string&amp;gt;Noto Sans S Chinese&amp;lt;/string&amp;gt; &amp;lt;/edit&amp;gt; &amp;lt;/match&amp;gt; 我用的是Noto Sans S Chinese，如果用文泉驿正黑就改成WenQuanYi Zen Hei。
怎么使这个配置生效？有两个方法。
环境变量 FONTCONFIG_FILE 这个方法需要一个为 Dota 2 单独准备的fontconfig_file，姑且命名为dota2-fontconfig.conf。
文件内容如下:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 &amp;lt;?</description></item><item><title>解决用 ldconfig 指定 libgl 库时 Steam 的异常</title><link>/2015/01/%E8%A7%A3%E5%86%B3%E7%94%A8-ldconfig-%E6%8C%87%E5%AE%9A-libgl-%E5%BA%93%E6%97%B6-steam-%E7%9A%84%E5%BC%82%E5%B8%B8/</link><pubDate>Wed, 28 Jan 2015 00:00:00 +0000</pubDate><guid>/2015/01/%E8%A7%A3%E5%86%B3%E7%94%A8-ldconfig-%E6%8C%87%E5%AE%9A-libgl-%E5%BA%93%E6%97%B6-steam-%E7%9A%84%E5%BC%82%E5%B8%B8/</guid><description>刚考完试，有点无聊，开 Steam 准备玩点游戏，结果发现之前的一个脚本不能用了。我的机器的情况是 Intel 集显 + NVIDIA 独显。两个显卡的切换一直是件很蛋疼的事情，optirun什么的性能实在太差，如果一直独显直出，耗电也是个大问题。这个学期初和 @hyrathb juju 一起研究了一下，用 ldconfig 尽可能减少切换显卡带来的麻烦(就是先关X, 然后跑个脚本开独显直出的X, 如果需要这个解决方案我可以单独po文).
Steam 的坑 Steam 为了Need to add /usr/lib32 to the library path to pick up libvdpau_nvidia.so on Ubuntu 12.04把/usr/lib32加进了LD_LIBRARY_PATH变量，结果虽然在 ldconfig 中本来是 NVIDIA 的 libgl 库优先，但是/usr/lib32里面默认 mesa 的 libgl 库的链接却被优先加载了。导致 Steam 启动时会报Not direct rendering之类的错误。
之前的解决办法 这个学期初是顺便解决了这个问题的，当时就是把 steam.sh 里面如下这行注释掉。
1 export LD_LIBRARY_PATH=&amp;#34;$LD_LIBRARY_PATH:/usr/lib32&amp;#34; 但是 Steam 会在启动时检查文件完整性，第一次检查是检查大小，所以把文件删掉一个字节就好了。不过要在启动 Steam 后换回原文件，因为 Steam 会第二次检查文件完整性，这次大概是检查哈希值。我是写了个脚本，准备两个文件，原文件和修改后的文件，cp 两次。不过最近升级后，第一次检查的好像也是哈希值了。检查的那些步骤估计都是写进二进制的，想绕过也比较麻烦，这脚本就没救了。
新发现 这次仔细读了一下 steam.sh, 这一块代码还是可以好好利用一下的:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # and launch steam STEAM_DEBUGGER=$DEBUGGER unset DEBUGGER # Don&amp;#39;t use debugger if Steam launches itself recursively if [ &amp;#34;$STEAM_DEBUGGER&amp;#34; == &amp;#34;gdb&amp;#34; ] || [ &amp;#34;$STEAM_DEBUGGER&amp;#34; == &amp;#34;cgdb&amp;#34; ]; then # Set the LD_PRELOAD varname in the debugger, and unset the global version.</description></item></channel></rss>