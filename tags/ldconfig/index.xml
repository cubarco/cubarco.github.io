<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ldconfig on /home/cubl</title><link>/tags/ldconfig/</link><description>Recent content in ldconfig on /home/cubl</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 28 Jan 2015 00:00:00 +0000</lastBuildDate><atom:link href="/tags/ldconfig/index.xml" rel="self" type="application/rss+xml"/><item><title>解决用 ldconfig 指定 libgl 库时 Steam 的异常</title><link>/2015/01/ldconfig-and-steam-workaround/</link><pubDate>Wed, 28 Jan 2015 00:00:00 +0000</pubDate><guid>/2015/01/ldconfig-and-steam-workaround/</guid><description>刚考完试，有点无聊，开 Steam 准备玩点游戏，结果发现之前的一个脚本不能用了。我的机器的情况是 Intel 集显 + NVIDIA 独显。两个显卡的切换一直是件很蛋疼的事情，optirun什么的性能实在太差，如果一直独显直出，耗电也是个大问题。这个学期初和 @hyrathb juju 一起研究了一下，用 ldconfig 尽可能减少切换显卡带来的麻烦(就是先关X, 然后跑个脚本开独显直出的X, 如果需要这个解决方案我可以单独po文).
Steam 的坑 Steam 为了Need to add /usr/lib32 to the library path to pick up libvdpau_nvidia.so on Ubuntu 12.04把/usr/lib32加进了LD_LIBRARY_PATH变量，结果虽然在 ldconfig 中本来是 NVIDIA 的 libgl 库优先，但是/usr/lib32里面默认 mesa 的 libgl 库的链接却被优先加载了。导致 Steam 启动时会报Not direct rendering之类的错误。
之前的解决办法 这个学期初是顺便解决了这个问题的，当时就是把 steam.sh 里面如下这行注释掉。
1 export LD_LIBRARY_PATH=&amp;#34;$LD_LIBRARY_PATH:/usr/lib32&amp;#34; 但是 Steam 会在启动时检查文件完整性，第一次检查是检查大小，所以把文件删掉一个字节就好了。不过要在启动 Steam 后换回原文件，因为 Steam 会第二次检查文件完整性，这次大概是检查哈希值。我是写了个脚本，准备两个文件，原文件和修改后的文件，cp 两次。不过最近升级后，第一次检查的好像也是哈希值了。检查的那些步骤估计都是写进二进制的，想绕过也比较麻烦，这脚本就没救了。
新发现 这次仔细读了一下 steam.sh, 这一块代码还是可以好好利用一下的:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # and launch steam STEAM_DEBUGGER=$DEBUGGER unset DEBUGGER # Don&amp;#39;t use debugger if Steam launches itself recursively if [ &amp;#34;$STEAM_DEBUGGER&amp;#34; == &amp;#34;gdb&amp;#34; ] || [ &amp;#34;$STEAM_DEBUGGER&amp;#34; == &amp;#34;cgdb&amp;#34; ]; then # Set the LD_PRELOAD varname in the debugger, and unset the global version.</description></item></channel></rss>